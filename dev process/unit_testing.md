## Unit testing

### Before start...

- 여기에서 말하는 단위란 객체, 함수, 모듈, 기능 등의 하나의 테스트가 테스팅하는 대상을 말함

### What is unit testing?

- Unit test(단위 테스트)란 특정 코드, 함수, 모듈이 목적에 따라 제대로 작동하는지를 검증하는 절차를 말함
- 모든 함수/메소드/모듈에 대해 테스트 케이스를 작성하여 코드 변경시 문제가 발생할 때 미리 만들어진 테스트 케이스들을 통해 빠르게 문제를 해결할 수 있게 됨

### 단위 테스트의 장점

1. 사전에 버그 발견이 쉬움

   - 단위 테스트를 통해 코드의 각 부분이 정확하게 동작하는지를 확인할 수 있어, 문제 발생시 어느 단위에서 문제가 발생했는지 알아내기가 쉬워져 디버깅에 도움이 되고, 전체적으로 코드 안정성을 보장할 수 있음
   - 개발 과정에서 디버깅이 차지하는 시간이 상당한데, 이런 디버깅 시간또한 단축되므로 개발자에게 좋음

2. 코드 리팩토링에 용이함

   - 코드 리팩토링시에도 단위테스트를 통해 리팩토링된 코드의 동작 안정성을 보장할 수 있게 되므로 더 자유롭게 코드를 수정할 수 있음
   - [회귀 테스트](https://ko.wikipedia.org/wiki/%ED%9A%8C%EA%B7%80_%ED%85%8C%EC%8A%A4%ED%8A%B8)

3. 통합이 간단함

   - 단위 테스트를 통해 각 단위의 안정성이 보장되어 각 부분을 검증하고 그 부분들을 합쳐 다시 검증하는 [통합 테스트](https://ko.wikipedia.org/wiki/%ED%86%B5%ED%95%A9_%EC%8B%9C%ED%97%98) 등에 유용함.

4. 자연스럽게 코드가 작은 단위로 분리됨
   - 단위 테스트 작성을 위해서라도 코드를 작은 부분으로 나누게 되어 한 단위가 하나의 기능만을 담당하는, 객체지향의 단일 책임 원칙을 자연스럽게 만족하게 된다.

### 좋은 단위 테스트의 조건

1. 각 단위 테스트 독립적이어야 함

   - 하나의 단위 테스트는 하나의 대상에 집중해야 하며, 다른 테스트들과도 독립적이어야 함
   - 만약 한 단위 테스트가 여러 단위를 검증한다면 문제가 발생했을 때 어떤 단위에서 문제가 발생하는지를 알아내기 힘듬
   - 다른 테스트들과 독립적이지 못하다면 어떤 개별 테스트를 위해 다른 연관된 모든 테스트도 함께 실행되어야 하게 되어 문제 발생시에 어느 단위에서 문제가 발생하는지를 추가적으로 검증해야 하기 때문

2. 테스트가 해당 단위에 의존하지 않아야 함

   - 인풋에 대한 리턴만을 확인하도록 테스트를 만들어야 함
   - 단위에 의존하는 테스트 케이스는 단위가 변경되면 같이 수정되어야 하는 문제가 있음

3. 입력에 대한 결과가 일관되어야 함

   - 코드 수정이 이루어지지 않는 한 어떤 입력에 대해 매번 동일한 결과가 출력되어야 함

4. 빨라야 함
   - 테스트를 작성하거나 테스트를 돌리는 데에 너무 많은 시간이 걸리면 안됨

### 주의할 점

- 코드 검사 비율은 코드의 품질이 될 수 없음
  - 모든 코드에 대해 테스트 코드를 작성하는 행동은 장점보다 단점이 더 많을 수 있음
  - 극단적인 케이스까지 고려하게 되면 많은 시간이 소요되고, 코드 품질에 주는 영향이 크지도 않음

### [Test Double](https://beomseok95.tistory.com/295)

- 독립적인 단위 테스트를 위해서 단위 내의 다른 단위들과의 연결을 들어낼 필요가 있음. 이때 들어낸 대상을 대신해 채워지는 더미를 Test double이라고 부름

  - 네트워크, 데이터 베이스 등의 통제하기 힘든 외부 시스템과 얽혀있는 메소드를 단위테스트 하기는 꽤나 어려울 수 있음
  - 이 때 외부와 연결된 부분을 대신하기 위해 만들어지는 객체 등을 test double이라 함

- Fake / Mock로 부르기도 하는 듯?

- Dummy

  - 단위에 전달되지만 사용되지는 않는 파라미터
  - 구현이 없는 빈 객체

- [Stub](https://medium.com/@SlackBeck/%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%8A%A4%ED%85%81-test-stub-%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-ff9c8840c1b0#.68pavd8tg)

  - 미리 준비된 결과만을 제공함 stub

- Fake

  - 특정 입력에 대해 정해진 출력을 내도록 하드코딩되면 fake

- Spy

  - Stub과 거의 동일하지만 호출되었을 때 데이터를 기록하고 확인하는 기능이 추가됨

- Mock, Mock object
  - https://beomseok95.tistory.com/295
  - https://www.crocus.co.kr/1555

### 상태 기반 / 행위 기반 테스트

### Questions & Todo

- [x] Mock와 Test double의 차이

  - 둘을 비슷한 의미로 사용하는 포스팅들이 있는데, 둘의 차이가 정확히 뭔지 확인해보기
  - 다름. test double에는 여러 종류가 있는데, 그중 하나가 mock이고, mock는 다른 test double들과는 다른 방식으로 쓰임

- [ ] Mock, 상태/행위 기반 테스트에 대해 정리하기
